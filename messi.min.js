!function(t,s){function i(o,e){var n,l=this;if(l.options=s.extend({},i.prototype.options,e||{}),l.messi=s(l.template),l.setContent(o),null===l.options.title?s(".messi-titlebox",l.messi).remove():(s(".messi-title",l.messi).append(l.options.title),0!==l.options.buttons.length||l.options.autoclose||l.options.closeButton&&(n=s('<span class="messi-closebtn"></span>'),n.bind("click",function(){l.hide()}),s(".messi-titlebox",this.messi).prepend(n)),null!==l.options.titleClass&&s(".messi-titlebox",this.messi).addClass(l.options.titleClass)),null!==l.options.width&&s(".messi-box",l.messi).css("width",l.options.width),l.options.buttons.length>0)for(var h=function(){l.options.callback.call(this.value)},a=0;a<l.options.buttons.length;a++){var c=l.options.buttons[a]["class"]?l.options.buttons[a]["class"]:"",p='<button data-value="'+l.options.buttons[a].val+'" class="btn '+c+'" href="#">'+l.options.buttons[a].label+"</button>";p=s('<div class="btnbox">'+p+"</div>",{}),s(".messi-actions",this.messi).append(p),s(document).delegate(".messi-actions button","click",function(){{var t=null;s(this).data("value")}"function"==typeof l.options.callback&&(t=h),l.hide(t)})}else s(".messi-footbox",this.messi).remove();return 0!==l.options.buttons.length||null!==l.options.title||l.options.autoclose||l.options.closeButton&&(n=s('<span class="messi-closebtn"></span>'),n.bind("click",function(){l.hide()}),s(".messi-content",this.messi).prepend(n)),l.modal=l.options.modal?s('<div class="messi-modal"></div>').css({opacity:l.options.modalOpacity,width:s(document).width(),height:s(document).height(),"z-index":l.options.zIndex+s(".messi").length}).appendTo(document.body):null,l.options.show&&l.show(),s(t).bind("resize scroll",function(){l.resize()}),null!==l.options.autoclose&&setTimeout(function(t){var i=s.data(this,"value"),o=null!==t.options.callback?function(){t.options.callback(i)}:null;t.hide(o)},l.options.autoclose,this),l}i.prototype={options:{autoclose:null,buttons:[],callback:null,center:!0,closeButton:!0,height:"auto",title:null,titleClass:null,minMargin:15,modal:!1,modalOpacity:.2,padding:"10px",show:!0,unload:!0,viewport:{top:"0px",left:"0px"},width:"500px",zIndex:99999},template:'<div class="messi"><div class="messi-box"><div class="messi-wrapper"><div class="messi-titlebox"><span class="messi-title"></span></div><div class="messi-content"></div><div class="messi-footbox"><div class="messi-actions"></div></div></div></div></div>',content:"<div></div>",visible:!1,setContent:function(t){s(".messi-content",this.messi).css({padding:this.options.padding,height:this.options.height}).empty().append(t)},viewport:function(){return{top:(s(t).height()-this.messi.height())/2+s(t).scrollTop()+"px",left:(s(t).width()-this.messi.width())/2+s(t).scrollLeft()+"px"}},show:function(){this.visible||(0===this.messi.parent().length&&(this.modal&&this.modal.appendTo(document.body),this.messi.appendTo(document.body)),this.modal&&this.modal.show(),this.options.center?this.options.viewport=this.viewport(s(".messi-box",this.messi)):this.nudge(),this.messi.css({top:this.options.viewport.top,left:this.options.viewport.left,"z-index":this.options.zIndex+s(".messi").length}).show().animate({opacity:1},300),this.visible=!0)},hide:function(t){if(this.visible){var s=this;return"function"==typeof t&&t.call(this)===!1?this:(this.messi.animate({opacity:0},300,function(){s.modal&&s.modal.css({display:"none"}),s.messi.css({display:"none"}),s.visible=!1,s.options.unload&&s.unload()}),this)}},resize:function(){this.options.modal&&s(".messi-modal").css({width:s(document).width(),height:s(document).height()}),this.options.center&&(this.options.viewport=this.viewport(s(".messi-box",this.messi)),this.messi.css({top:this.options.viewport.top,left:this.options.viewport.left}))},toggle:function(){return this[this.visible?"hide":"show"](),this},unload:function(){this.visible&&this.hide(),s(t).unbind("resize scroll",function(){this.resize()}),this.modal&&this.modal.remove(),this.messi.remove()},nudge:function(){var i=s(t),o=this.options.viewport.left.replace("px",""),e=this.options.viewport.top.replace("px","");if(this.isNumber(o)&&this.isNumber(e)){o=parseInt(o,10),e=parseInt(e,10);var n=s(document).scrollLeft()+i.width()-this.messi.width()-this.options.minMargin;o>n&&(o-=this.messi.width()+2*this.options.minMargin),o=this.max(o,0),e+this.messi.height()>i.height()+s(document).scrollTop()&&(e-=this.messi.height()+this.options.minMargin),this.options.viewport.left=o.toString()+"px",this.options.viewport.top=e.toString()+"px"}},max:function(t,s){return t>s?t:s},isNumber:function(t){return!isNaN(parseFloat(t))&&isFinite(t)}},s.extend(i,{alert:function(t,o,e){var n=[{id:"ok",label:"OK",val:"OK"}];return e=s.extend({closeButton:!1,buttons:n,callback:function(){}},e||{},{show:!0,unload:!0,callback:o}),new i(t,e)},ask:function(t,o,e){var n=[{id:"yes",label:"Yes",val:"Y","class":"btn-success"},{id:"no",label:"No",val:"N","class":"btn-danger"}];return e=s.extend({closeButton:!1,modal:!0,buttons:n,callback:function(){}},e||{},{show:!0,unload:!0,callback:o}),new i(t,e)},img:function(o,e){var n=new Image;s(n).load(function(){var o={width:s(t).width()-50,height:s(t).height()-50},l=this.width>o.width||this.height>o.height?Math.min(o.width/this.width,o.height/this.height):1;s(n).css({width:this.width*l,height:this.height*l}),e=s.extend(e||{},{show:!0,unload:!0,closeButton:!0,width:this.width*l,height:this.height*l,padding:0}),new i(n,e)}).error(function(){"object"==typeof t.console&&console.log("Error loading "+o)}).attr("src",o)},load:function(o,e){e=s.extend(e||{},{show:!0,unload:!0,params:{}});var n={url:o,data:e.params,dataType:"html",cache:!1,error:function(s){"object"==typeof t.console&&console.log(s.responseText)},success:function(t){new i(t,e)}};s.ajax(n)}}),t.Messi=i,s.Messi=i}(window,jQuery);